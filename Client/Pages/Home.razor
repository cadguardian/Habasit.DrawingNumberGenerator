@page "/"

@using Client.Features.BeltDesigner
@using Client.Features.CADTemplates.Archive
@using Client.Features.DWGNumberDecipher
@using Client.Features.DWGRequestParser
@using Client.Services
@using DNG.Library.Models
@using Microsoft.AspNetCore.Components.Forms

@inject IJSRuntime JSRuntime
@inject IStateContainer State
@inject IDrawingRequestProcessor DrawingRequestProcessor

<PageTitle>belt-tools.vercel.app</PageTitle>

@* <h3 class="display-6">Special Build - Plastic Modular Belt</h3> *@

<div class="container-fluid no-print" id="navbarNav">
    <ul class="nav justify-content-center">
        <ShowInstructionsComponent />
        <li class="nav-item">
            <a class="nav-link fw-semibold" target="_blank" href="https://product-portal.intranet.habasit.com/view/v_portal_pmb"><i class="fa-solid fa-book"></i> Portal</a>
        </li>
        <li class="nav-item">
            <a class="nav-link fw-semibold" target="_blank" href="https://www.habasit.com/-/media/Project/Habasit/PublicWebSite/Documents/English/Products/Plastic-Modular/4178_Habasit-Link-Plastic-Modular-Belts-Product-Guide_0124_en.pdf"><i class="fa-solid fa-puzzle-piece"></i> Product</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active  fw-semibold" target="_blank" href="https://misbelt.com/wp-content/uploads/2018/01/HabaLINK-Plastic-Modular.pdf"><i class="fa-solid fa-circle-info"></i> Specs</a>
        </li>
    </ul>
</div>


<EditForm EditContext="editContext" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />

    <DWGRequestForm />
</EditForm>

<PartsFinderView />

<DrawingFinderView/>

<DWGNumberDecipherView />

<TitleBlockView/>

<CADTemplatesView />

<JSONView />

<PrintView />

<BeltDesignerView />


@code {
    private EditContext? editContext;

    protected override void OnInitialized()
    {
        editContext = new EditContext(State.DrawingRequest);
        editContext.OnFieldChanged += (sender, e) => editContext.Validate(); // Triggers validation on field change

        // Immediately trigger validation when form loads
        editContext.Validate();
    }

    private void HandleValidSubmit()
    {
        DrawingRequestProcessor.GenerateDrawingNumber();
    }
}
