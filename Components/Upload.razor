@page "/export-upload"
@using DNG.Library.Data
@using DNG.Library.Models
@using System.Text.Json
@inject IJSRuntime JS
@inject IDrawingNumber DrawingNumber


<!-- Export DrawingNumber button -->
<button type="button" @onclick="ExportDrawingNumber" class="btn ntn-sm btn-outline-success mb-3">Export Drawing Number As JSON</button>

@* <!-- Upload File for DrawingNumber -->
<input type="file" @onchange="OnFileChange" class="form-control mb-3" />

 *@
@code {

    [Parameter]
    public DrawingRequest DrawingRequest { get; set; } 
    private string uploadedData;

    // Export the QueryString to a JSON file
    // Export the QueryString to a JSON file
    private async Task ExportDrawingNumber()
    {
        // Serialize to JSON and maintain hierarchy
        var json = System.Text.Json.JsonSerializer.Serialize(DrawingRequest, new JsonSerializerOptions
            {
                WriteIndented = true  // Pretty print for better readability (optional)
            });

        // Trigger JavaScript to save the file
        await JS.InvokeVoidAsync("saveAsFile", "drawingnumber.json", json);
    }



    // Handle file change and upload the JSON file
    private async Task OnFileChange(ChangeEventArgs e)
    {
        var file = ((Microsoft.AspNetCore.Components.Forms.IBrowserFile)e.Value).OpenReadStream();

        using (var streamReader = new System.IO.StreamReader(file))
        {
            var content = await streamReader.ReadToEndAsync();
            uploadedData = content;

            // Deserialize the JSON content and populate QueryString and drawingRequest
            var importedData = System.Text.Json.JsonSerializer.Deserialize<DrawingRequest>(content);

            if (importedData != null)
            {
                DrawingRequest = importedData;
            }
        }
    }
}
